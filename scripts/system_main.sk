# ===============================================================================================================================================================================================
# Main Game System
# メイン言うてもサブとかないけどね
# ==============================================================================================================================================================================================


# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# 死亡時処理
# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
on death of player:
    if {status} is 1:
        execute console command "spawnpoint %player% -27663 309 36470"
        set {sidebar.%player%} to 2
        set {rank.%player%} to {rank.dummy}
        reduce {rank.dummy} by 1
        reduce {surviver} by 1
        add 1 to {kills.%attacker%}
        set {ranking.name.%{rank.%player%}%} to name of player
        set {ranking.kills.%{rank.%player%}%} to {kills.%player%}
        set {killranking::*} to "%{kills.%player%}% -- %name of player%"
        set player's gamemode to spectator
        if {surviver} is 2:
            wait 60 seconds
            loop all players:
                if {sidebar.%loop-player%} is 1:
                    give a snowball to loop-player
        if {surviver} is 1:
            execute console command "game end"
            set {status} to 2
            set {surviver} to 0
            set {rank.alive} to 1
            loop all players:
                if {sidebar.%loop-player%} is 1:
                    set {sidebar.%loop-player%} to 3
                    set {ranking.name.1} to name of loop-player
                    set {ranking.kills.1} to {kills.%loop-player%}
                    set {killranking::*} to "%{kills.%loop-player%}% -- %name of loop-player%"
        if damage cause is fall:
            broadcast "&c%victim% &rは高所から落下して死亡した (%{rank.%victim%}%位)"
            stop
        if damage cause is suffocation:
            broadcast "&c%victim% &rは安地へ逃げられずに死亡した (%{rank.%victim%}%位)"
            stop
        if damage cause is drown:
            broadcast "&c%victim% &rは溺れて死亡した (%{rank.%victim%}%位)"
            stop
        if damage cause is TNT:
            broadcast "&c%victim% &rは爆発に巻き込まれて死亡した (%{rank.%victim%}%位)"
            stop
        if damage cause is creeper:
            broadcast "&c%victim% &rは爆発に巻き込まれて死亡した (%{rank.%victim%}%位)"
            stop
        if damage cause is attack:
            broadcast "&b%attacker% &r✈► &c%victim% &r(%{rank.%victim%}%位)"
            stop
        else:
            broadcast "&c%victim% &rはなんか知らんが死亡した &r(%{rank.%victim%}%位)"
            stop



# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# ブロック掘削
# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
on break:
    if {destroyable} is "true":
        stop
    else:
        if event-block is log:
            stop
        if event-block is planks:
            stop
        else:
            cancel event



# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# ブロック設置後に削除
# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#on place:
    #if event-block is log:
        #wait 5 seconds
        #break event-block
    #if event-block is planks:
        #wait 5 seconds
        #break event-block



# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# クラフト禁止
# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
on craft of crafting table:
    cancel event
    close player'S inventory
    message "&b[運営] &r作業台の作成はできません" to player



# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# ショップ展開トリガー
# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
on rightclick on villager:
    cancel event
    open chest inventory with 1 row named "&0Shop" to player
    set slot 2 of player's current inventory to diamond sword named "&d売る"
    set slot 6 of player's current inventory to emerald named "&a買う"
on inventory click:
    if event-item is black stained glass pane named " ":
        cancel event
    if event-item is barrier block named "&r&c閉じる":
        cancel event
        play sound "block.stone_button.click_on" to player
        close player's inventory



# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# 雪玉爆弾
# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
on right click with snowball:
    set {use.snowball.%player%} to 1

on projectile hit:
    if {use.snowball.%shooter%} is 1:
        create an explosion of force 1 at the projectile
    set {use.snowball.%shooter%} to 0



# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# アイテム消滅（負荷軽減措置）
# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
on item spawn:
    wait 10 seconds
    execute console command "kill @e[type=item]"







# ===============================================================================================================================================================================================
#
# ===Legacy System===
#
# ===============================================================================================================================================================================================
# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# タイマー({switch.timer}が"on"でタイマー作動)
# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#every 1 second:
    #if {switch.timer} is "on":
        #reduce {timer} by 1
    #if {timer} is 0:
        #make player execute command "function shimashima:01_game_end"
        #set {switch.timer} to "off"3

# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# 達磨さんが転んだPVP（要skQuary）
# ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#on any movement:
    #message "w" to player


